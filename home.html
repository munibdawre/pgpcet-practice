<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Home â€” PGP-CET</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="assets/css/style.css"/>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-md navbar-light bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#">PGP-CET Practice</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navMenu">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" href="home.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="upload.html">Upload</a></li>
        <li class="nav-item"><a class="nav-link" href="attempts.html">Attempts</a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="logout">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container py-4">
  <div class="card p-3 shadow-sm mb-3">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h5 id="welcome">Hello, <span id="userName"></span> </h5>
        <div class="text-muted small">Start a mock test</div>
      </div>
      <div>
        <button id="startTest" class="btn btn-success">Start Test</button>
      </div>
    </div>
  </div>

  <div class="card p-3 shadow-sm">
    <h6>Recent Attempts</h6>
    <table class="table mt-2">
      <thead>
        <tr><th>Date</th><th>Score</th><th></th></tr>
      </thead>
      <tbody id="recentBody">
        <tr><td colspan="3">Loading...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js" type="module"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js" type="module"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";

  // âœ… Replace with your actual Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyB6RuIeIbu34cIHqoScC3NYfpZHqXy2SME",
    authDomain: "pgpcet-practice.firebaseapp.com",
    projectId: "pgpcet-practice",
    storageBucket: "pgpcet-practice.firebasestorage.app",
    messagingSenderId: "332921568405",
    appId: "1:332921568405:web:475087028328263a982f9c",
    measurementId: "G-H67DHPRCMR"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const userNameEl = document.getElementById("userName");
  const logoutBtn = document.getElementById("logout");

  // ðŸ§  Get logged-in user's name from Firebase
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const uid = user.uid;
      try {
        const snapshot = await get(child(ref(db), `users/${uid}`));
        if (snapshot.exists()) {
          const data = snapshot.val();
          userNameEl.textContent = data.name || "User";
        } else {
          userNameEl.textContent = "User";
        }
      } catch (error) {
        console.error("Error fetching user name:", error);
        userNameEl.textContent = "User";
      }
    } else {
      // No user logged in
      window.location.href = "index.html";
    }
  });

  // ðŸ Logout
  logoutBtn.addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "index.html";
  });
</script>

<script type="module" src="assets/js/home.js"></script>
</body>
</html>
