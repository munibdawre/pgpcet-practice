<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - PGP-CET</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #111; color: #eee; }
    .card { background-color: #1c1c1c; border: 1px solid #333; }
    .table { color: #eee; }
    select, input, button { border-radius: 0.5rem !important; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">PGP-CET Admin</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
          <li class="nav-item"><a href="upload.html" class="nav-link">Upload Questions</a></li>
          <li class="nav-item"><a href="attempt.html" class="nav-link">Attempt Test</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <!-- User Management -->
    <div class="card mb-4 p-3">
      <h4>User Logins</h4>
      <table class="table table-dark table-hover align-middle" id="userTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Username</th>
            <th>Email</th>
            <th>Last Login</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Question Management -->
    <div class="card p-3">
      <h4>Question Bank</h4>
      <div class="d-flex gap-2 align-items-center mb-3">
        <label for="subjectSelect" class="form-label mb-0">Select Subject:</label>
        <select id="subjectSelect" class="form-select w-auto">
          <option value="">-- Choose Subject --</option>
          <option>Anatomy</option>
          <option>Physiology</option>
          <option>Biochemistry</option>
          <option>Fundamentals of Exercise Therapy</option>
          <option>Fundamentals of Electro Therapy</option>
          <option>Pharmacology</option>
          <option>Pathology & Microbiology</option>
          <option>Psychology</option>
          <option>Psychiatry</option>
          <option>Electrical Agents</option>
          <option>Kinesio Therapeutics</option>
          <option>General Surgery & Orthopedics</option>
          <option>Medicine</option>
          <option>OBGY</option>
          <option>Physical Diagnosis & Manipulative Skills</option>
          <option>Physiotherapy in Musculoskeletal Condition</option>
          <option>Physiotherapy in Neurosciences</option>
          <option>Physiotherapy in General Medical & Gen. surgical condition</option>
          <option>Physiotherapy in Community Health</option>
        </select>
      </div>

      <table class="table table-dark table-striped align-middle" id="questionTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Question</th>
            <th>Answer</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // ---- USER MANAGEMENT ----
    function loadUsers() {
      const userTable = document.querySelector("#userTable tbody");
      userTable.innerHTML = "";
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      users.forEach((u, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${u.username}</td>
          <td>${u.email}</td>
          <td>${u.lastLogin || "N/A"}</td>
          <td><button class="btn btn-danger btn-sm" onclick="deleteUser(${i})">Delete</button></td>
        `;
        userTable.appendChild(row);
      });
    }

    function deleteUser(index) {
      if (confirm("Are you sure you want to delete this user?")) {
        const users = JSON.parse(localStorage.getItem("users") || "[]");
        users.splice(index, 1);
        localStorage.setItem("users", JSON.stringify(users));
        loadUsers();
      }
    }

    // ---- QUESTION MANAGEMENT ----
    function loadQuestions(subject) {
      const questionTable = document.querySelector("#questionTable tbody");
      questionTable.innerHTML = "";
      if (!subject) return;
      const questions = JSON.parse(localStorage.getItem("questions_" + subject) || "[]");
      questions.forEach((q, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${q.question}</td>
          <td>${q.answer}</td>
          <td><button class="btn btn-danger btn-sm" onclick="deleteQuestion('${subject}', ${i})">Delete</button></td>
        `;
        questionTable.appendChild(row);
      });
    }

    function deleteQuestion(subject, index) {
      if (confirm("Are you sure you want to delete this question?")) {
        const key = "questions_" + subject;
        const questions = JSON.parse(localStorage.getItem(key) || "[]");
        questions.splice(index, 1);
        localStorage.setItem(key, JSON.stringify(questions));
        loadQuestions(subject);
      }
    }

    document.getElementById("subjectSelect").addEventListener("change", e => {
      loadQuestions(e.target.value);
    });

    // INIT
    loadUsers();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
